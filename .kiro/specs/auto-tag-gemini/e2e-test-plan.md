# E2Eテスト計画書

## 概要

このドキュメントは、Auto Tagger機能のエンドツーエンド（E2E）テスト計画を定義します。E2Eテストは、実際のユーザーが機能を使用する際の完全なフローを検証します。

---

## E2Eテストとは

### 統合テストとの違い

| 観点 | 統合テスト | E2Eテスト |
|------|-----------|----------|
| 焦点 | コンポーネント間の連携 | ユーザー体験全体 |
| 範囲 | 個別機能の動作確認 | 開始から完了までの完全フロー |
| 視点 | 技術的な正確性 | ユーザーの目的達成 |
| 実行環境 | テスト環境 | 本番に近い環境 |

### E2Eテストの目的

1. **ユーザーストーリーの検証**: 実際のユースケースが正しく動作するか
2. **完全なワークフローの確認**: 開始から終了までの一連の流れ
3. **実環境での動作確認**: 実際のObsidian環境での動作
4. **ユーザー体験の評価**: UIの使いやすさと直感性

---

## E2Eテストシナリオ

### シナリオ1: 初回利用フロー

**ユーザーストーリー**:
> 新規ユーザーとして、Auto Taggerを初めて使用し、自分のノートに自動的にタグを付けたい

**前提条件**:
- Obsidianがインストールされている
- プラグインがインストールされている
- Gemini API keyを持っている
- 既存のノートが10件以上ある

**テストステップ**:

1. **プラグイン設定**
   - [ ] Obsidianを起動
   - [ ] 設定 → Community plugins → Personal Context を開く
   - [ ] Gemini API keyを入力
   - [ ] 保存ボタンをクリック
   - [ ] 設定が保存されたことを確認

2. **Auto Tagger設定**
   - [ ] Auto Tagger設定セクションにスクロール
   - [ ] Target directoryを設定（例: `notes/`）
   - [ ] Exclude note tagを設定（例: `processed`）
   - [ ] System instructionを確認（デフォルトのまま）
   - [ ] 設定を保存

3. **Auto Taggerビューを開く**
   - [ ] リボンアイコン（タグアイコン）をクリック
   - [ ] Auto Taggerビューが右サイドバーに表示される
   - [ ] 設定した値が表示されている

4. **自動タグ付けを実行**
   - [ ] 「開始」ボタンをクリック
   - [ ] 進捗バーが表示される
   - [ ] 処理中のノート名が表示される
   - [ ] ログエントリがリアルタイムで追加される
   - [ ] 処理が完了するまで待つ

5. **結果を確認**
   - [ ] サマリーセクションが表示される
   - [ ] 成功件数が表示される
   - [ ] ログファイルが作成されている
   - [ ] ノートを開いてタグが追加されていることを確認

**期待される結果**:
- ✅ 全ての設定が正しく保存される
- ✅ ビューが正しく表示される
- ✅ 処理が正常に完了する
- ✅ ノートにタグが追加される
- ✅ ログファイルが作成される
- ✅ ユーザーが迷わず操作できる

**所要時間**: 約10分

---

### シナリオ2: 日常的な使用フロー

**ユーザーストーリー**:
> 既存ユーザーとして、新しく作成したノートに定期的にタグを付けたい

**前提条件**:
- Auto Taggerの設定が完了している
- 新しいノートを5件作成した
- 既存のノートには`processed`タグが付いている

**テストステップ**:

1. **新規ノートの作成**
   - [ ] 5件の新しいノートを作成
   - [ ] 各ノートに内容を記入
   - [ ] `processed`タグは付けない

2. **Auto Taggerを起動**
   - [ ] リボンアイコンをクリック
   - [ ] または、コマンドパレット（Ctrl/Cmd+P）から「Open Auto Tagger」を実行

3. **対象ノートの確認**
   - [ ] 「開始」ボタンをクリック
   - [ ] 対象ノート数が5件と表示される

4. **処理の実行**
   - [ ] 処理が開始される
   - [ ] 進捗が表示される
   - [ ] 完了を待つ

5. **結果の確認と次のアクション**
   - [ ] 新しいノートにタグが追加されている
   - [ ] 既存のノート（`processed`タグ付き）は変更されていない
   - [ ] 処理済みノートに`processed`タグを手動で追加

**期待される結果**:
- ✅ 新規ノートのみが処理される
- ✅ 既存ノートは変更されない
- ✅ 処理が迅速に完了する（5件で10-20秒）
- ✅ ワークフローがスムーズ

**所要時間**: 約5分

---

### シナリオ3: 大量ノート処理フロー

**ユーザーストーリー**:
> 既存の大量のノート（50件以上）に一括でタグを付けたい

**前提条件**:
- 50件以上のノートがある
- タグが付いていないノートが多数ある
- 時間に余裕がある

**テストステップ**:

1. **処理前の準備**
   - [ ] 対象ディレクトリを確認
   - [ ] バックアップを取る（推奨）
   - [ ] 処理時間を見積もる（50件で約2-3分）

2. **Auto Taggerを起動**
   - [ ] Auto Taggerビューを開く
   - [ ] 設定を確認

3. **処理の開始**
   - [ ] 「開始」ボタンをクリック
   - [ ] 対象ノート数を確認（例: 50件）
   - [ ] 処理開始を確認

4. **処理中の監視**
   - [ ] 進捗バーを確認
   - [ ] バッチ番号の増加を確認（1→2→3...）
   - [ ] ログエントリを確認
   - [ ] エラーがないか確認

5. **途中で停止する場合**
   - [ ] 「停止」ボタンをクリック
   - [ ] 現在のバッチが完了するまで待つ
   - [ ] 部分的なサマリーが表示される

6. **完了後の確認**
   - [ ] サマリーを確認
   - [ ] ログファイルを確認
   - [ ] ランダムにノートを開いてタグを確認

**期待される結果**:
- ✅ 大量のノートが正常に処理される
- ✅ 進捗が明確に表示される
- ✅ 停止機能が正しく動作する
- ✅ メモリやパフォーマンスの問題がない
- ✅ ログファイルが適切に記録される

**所要時間**: 約10-15分（処理時間含む）

---

### シナリオ4: エラーリカバリーフロー

**ユーザーストーリー**:
> 処理中にエラーが発生した場合でも、適切に対処して処理を続行したい

**前提条件**:
- Auto Taggerが設定されている
- 意図的にエラーを発生させる準備ができている

**テストステップ**:

1. **エラーケース1: API keyエラー**
   - [ ] 設定でAPI keyを削除
   - [ ] 「開始」ボタンをクリック
   - [ ] エラーメッセージを確認
   - [ ] API keyを再設定
   - [ ] 再度実行して成功を確認

2. **エラーケース2: ネットワークエラー**
   - [ ] 処理を開始
   - [ ] ネットワークを一時的に切断（可能な場合）
   - [ ] エラーメッセージを確認
   - [ ] ネットワークを復旧
   - [ ] 再度実行して成功を確認

3. **エラーケース3: 対象ノートなし**
   - [ ] 全てのノートに`processed`タグを付ける
   - [ ] 「開始」ボタンをクリック
   - [ ] 「対象ノートがありません」エラーを確認
   - [ ] 新しいノートを作成
   - [ ] 再度実行して成功を確認

4. **エラーからの回復**
   - [ ] エラーメッセージが明確か確認
   - [ ] 対処方法が理解できるか確認
   - [ ] 再実行が簡単にできるか確認

**期待される結果**:
- ✅ エラーメッセージが明確で理解しやすい
- ✅ アプリケーションがクラッシュしない
- ✅ エラー後も再実行できる
- ✅ ユーザーが対処方法を理解できる

**所要時間**: 約15分

---

### シナリオ5: カスタマイズフロー

**ユーザーストーリー**:
> 自分のニーズに合わせてAuto Taggerの動作をカスタマイズしたい

**前提条件**:
- Auto Taggerの基本的な使い方を理解している
- カスタマイズしたい要件がある

**テストステップ**:

1. **System Instructionのカスタマイズ**
   - [ ] 設定画面を開く
   - [ ] System Instructionフィールドを編集
   - [ ] カスタム指示を入力（例: "技術的なタグを優先してください"）
   - [ ] 保存

2. **除外タグの設定**
   - [ ] Exclude suggestion tagsを設定
   - [ ] 複数のタグをカンマ区切りで入力（例: "meta, system, private"）
   - [ ] 保存

3. **カスタマイズの効果を確認**
   - [ ] Auto Taggerを実行
   - [ ] 提案されたタグがカスタマイズを反映しているか確認
   - [ ] 除外タグが提案されていないか確認

4. **設定の調整**
   - [ ] 必要に応じてSystem Instructionを調整
   - [ ] 再度実行して結果を確認
   - [ ] 満足のいく結果が得られるまで繰り返す

**期待される結果**:
- ✅ カスタマイズが正しく反映される
- ✅ 設定変更が簡単にできる
- ✅ 効果が明確に確認できる
- ✅ ユーザーのニーズに合わせられる

**所要時間**: 約10分

---

### シナリオ6: マルチセッションフロー

**ユーザーストーリー**:
> 複数回に分けて、段階的にノートにタグを付けたい

**前提条件**:
- 大量のノートがある（30件以上）
- 一度に全て処理したくない

**テストステップ**:

1. **第1セッション: 最初の10件**
   - [ ] Target directoryを特定のフォルダに設定
   - [ ] 処理を実行
   - [ ] 完了後、処理済みノートに`processed`タグを追加

2. **第2セッション: 次の10件**
   - [ ] 別のフォルダに変更、または`processed`タグで除外
   - [ ] 処理を実行
   - [ ] 完了後、処理済みノートに`processed`タグを追加

3. **第3セッション: 残りのノート**
   - [ ] 残りのノートを処理
   - [ ] 全体のログを確認

4. **全体の確認**
   - [ ] 全てのノートが処理されたか確認
   - [ ] ログファイルに全セッションが記録されているか確認
   - [ ] タグの一貫性を確認

**期待される結果**:
- ✅ 複数セッションで段階的に処理できる
- ✅ 各セッションが独立して動作する
- ✅ ログファイルに全セッションが記録される
- ✅ 重複処理が発生しない

**所要時間**: 約20分（複数セッション含む）

---

## E2Eテスト実行ガイド

### 実行環境の準備

1. **本番に近い環境**
   - 実際のObsidianインストール
   - 実際のVault（テスト用でも可）
   - 有効なGemini API key
   - 安定したネットワーク接続

2. **テストデータ**
   - 様々な内容のノート（最低30件）
   - 既存のタグ（最低20個）
   - 異なるディレクトリ構造

3. **記録ツール**
   - スクリーンレコーダー（推奨）
   - スクリーンショットツール
   - タイマー（所要時間計測用）

### 実行手順

1. **事前準備**
   - [ ] 環境をセットアップ
   - [ ] テストデータを準備
   - [ ] 記録ツールを起動

2. **シナリオ実行**
   - [ ] 各シナリオを順番に実行
   - [ ] 各ステップを記録
   - [ ] 問題点をメモ

3. **結果記録**
   - [ ] 成功/失敗を記録
   - [ ] 所要時間を記録
   - [ ] ユーザー体験を評価

### 評価基準

各シナリオを以下の観点で評価:

| 観点 | 評価基準 |
|------|---------|
| **機能性** | 期待通りに動作するか |
| **使いやすさ** | 直感的に操作できるか |
| **パフォーマンス** | 許容範囲内の速度か |
| **エラー処理** | エラーが適切に処理されるか |
| **ドキュメント** | 説明が十分か |

評価スケール:
- ⭐⭐⭐⭐⭐ 優秀（5点）
- ⭐⭐⭐⭐ 良好（4点）
- ⭐⭐⭐ 普通（3点）
- ⭐⭐ 改善必要（2点）
- ⭐ 不十分（1点）

---

## E2Eテストチェックリスト

### シナリオ実行チェックリスト

- [ ] シナリオ1: 初回利用フロー
- [ ] シナリオ2: 日常的な使用フロー
- [ ] シナリオ3: 大量ノート処理フロー
- [ ] シナリオ4: エラーリカバリーフロー
- [ ] シナリオ5: カスタマイズフロー
- [ ] シナリオ6: マルチセッションフロー

### ユーザー体験チェックリスト

- [ ] 初回セットアップが簡単
- [ ] UIが直感的
- [ ] エラーメッセージが明確
- [ ] 処理速度が許容範囲
- [ ] ログが有用
- [ ] ドキュメントが十分

### 技術的チェックリスト

- [ ] データの整合性が保たれる
- [ ] メモリリークがない
- [ ] パフォーマンスが安定
- [ ] エラーハンドリングが適切
- [ ] ログファイルが正しく記録される

---

## 成功基準

### 必須（Must Have）

- ✅ 全シナリオが正常に完了する
- ✅ データの破損や損失がない
- ✅ クリティカルなエラーがない
- ✅ 基本的なユーザーフローがスムーズ

### 重要（Should Have）

- ✅ ユーザー体験が良好（平均4点以上）
- ✅ パフォーマンスが許容範囲
- ✅ エラーリカバリーが適切
- ✅ カスタマイズが機能する

### 推奨（Nice to Have）

- ✅ 全ての評価が4点以上
- ✅ ユーザーからのフィードバックが良好
- ✅ ドキュメントが充実
- ✅ 追加機能の要望が少ない

---

## トラブルシューティング

### E2Eテスト中の一般的な問題

1. **環境の問題**
   - Obsidianのバージョン不一致
   - プラグインの競合
   - ネットワークの不安定性

2. **データの問題**
   - テストデータの不足
   - タグの不足
   - ノートの内容が不適切

3. **実行の問題**
   - 手順の理解不足
   - タイミングの問題
   - 記録の失敗

### 解決方法

- `debugging-guide.md`を参照
- 環境を再セットアップ
- テストデータを再作成
- 手順を再確認

---

## E2Eテスト報告テンプレート

```markdown
# E2Eテスト実行報告

**実行日**: [日付]
**実行者**: [名前]
**環境**: [OS, Obsidianバージョン]

## 実行結果サマリー

- 実行シナリオ数: 6
- 成功: ___
- 失敗: ___
- スキップ: ___

## シナリオ別結果

### シナリオ1: 初回利用フロー
- 結果: ☐ 成功 ☐ 失敗
- 所要時間: ___ 分
- 評価:
  - 機能性: ⭐⭐⭐⭐⭐
  - 使いやすさ: ⭐⭐⭐⭐⭐
  - パフォーマンス: ⭐⭐⭐⭐⭐
- コメント: [...]

[他のシナリオも同様に記録]

## 総合評価

- 全体的な印象: [...]
- 改善が必要な点: [...]
- 良かった点: [...]

## 推奨事項

1. [推奨事項1]
2. [推奨事項2]

## 結論

☐ 本番リリース可能
☐ 軽微な修正後リリース可能
☐ 大幅な修正が必要
```

---

## まとめ

このE2Eテスト計画は、Auto Tagger機能が実際のユーザーシナリオで正しく動作することを確認するためのものです。

**重要なポイント**:
1. 実際のユーザーの視点でテストする
2. 完全なワークフローを確認する
3. ユーザー体験を評価する
4. 実環境での動作を確認する

**次のステップ**:
1. E2Eテスト環境を準備
2. 各シナリオを実行
3. 結果を記録
4. 改善点を特定
5. 必要に応じて修正

---

**ドキュメントバージョン**: 1.0
**最終更新日**: 2025-10-11
**ステータス**: レビュー準備完了
